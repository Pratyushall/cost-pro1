@import "tailwindcss";
@import "tw-animate-css";

/* Dark variant helper for Tailwind apply */
@custom-variant dark (&:is(.dark *));

/* =============================
   THEME TOKENS â€” NEW PALETTE
   ============================= */
:root {
  --background: oklch(0.95 0.02 300);
  --foreground: oklch(0.15 0.02 300);

  --card: oklch(0.99 0.01 300);
  --card-foreground: oklch(0.15 0.02 300);

  --popover: oklch(0.98 0.01 300);
  --popover-foreground: oklch(0.15 0.02 300);

  /* Primary / Secondary / Accent */
  --primary: oklch(0.52 0.15 320);
  --primary-foreground: oklch(0.98 0 0);
  --secondary: oklch(0.52 0.14 350);
  --secondary-foreground: oklch(0.98 0 0);
  --accent: oklch(0.5 0.16 290);
  --accent-foreground: oklch(0.98 0 0);

  --muted: oklch(0.94 0.02 300);
  --muted-foreground: oklch(0.45 0.02 300);

  --destructive: oklch(0.55 0.22 25);
  --destructive-foreground: oklch(0.98 0 0);

  --border: oklch(0.88 0.02 300);
  --input: oklch(0.96 0.01 300);
  --ring: oklch(0.52 0.15 320);

  /* Charts */
  --chart-1: oklch(0.52 0.15 320);
  --chart-2: oklch(0.52 0.14 350);
  --chart-3: oklch(0.5 0.16 290);
  --chart-4: oklch(0.48 0.17 310);
  --chart-5: oklch(0.54 0.13 330);

  --radius: 1rem;

  /* Sidebar */
  --sidebar: oklch(0.98 0 0);
  --sidebar-foreground: oklch(0.15 0.02 300);
  --sidebar-primary: oklch(0.52 0.15 320);
  --sidebar-primary-foreground: oklch(0.98 0 0);
  --sidebar-accent: oklch(0.96 0.01 300);
  --sidebar-accent-foreground: oklch(0.25 0.02 300);
  --sidebar-border: oklch(0.9 0.01 300);
  --sidebar-ring: oklch(0.52 0.15 320);
}

.dark {
  --background: oklch(0.15 0.02 300);
  --foreground: oklch(0.95 0 0);

  --card: oklch(0.18 0.02 300);
  --card-foreground: oklch(0.95 0 0);

  --popover: oklch(0.18 0.02 300);
  --popover-foreground: oklch(0.95 0 0);

  --primary: oklch(0.62 0.17 320);
  --primary-foreground: oklch(0.98 0 0);

  --secondary: oklch(0.62 0.16 350);
  --secondary-foreground: oklch(0.98 0 0);

  --muted: oklch(0.25 0.02 300);
  --muted-foreground: oklch(0.7 0.01 300);

  --accent: oklch(0.6 0.18 290);
  --accent-foreground: oklch(0.98 0 0);

  --destructive: oklch(0.6 0.22 25);
  --destructive-foreground: oklch(0.95 0 0);

  --border: oklch(0.3 0.02 300);
  --input: oklch(0.25 0.02 300);
  --ring: oklch(0.62 0.17 320);

  --chart-1: oklch(0.62 0.17 320);
  --chart-2: oklch(0.62 0.16 350);
  --chart-3: oklch(0.6 0.18 290);
  --chart-4: oklch(0.58 0.19 310);
  --chart-5: oklch(0.64 0.15 330);

  --sidebar: oklch(0.2 0.02 300);
  --sidebar-foreground: oklch(0.95 0 0);
  --sidebar-primary: oklch(0.62 0.17 320);
  --sidebar-primary-foreground: oklch(0.98 0 0);
  --sidebar-accent: oklch(0.25 0.02 300);
  --sidebar-accent-foreground: oklch(0.95 0 0);
  --sidebar-border: oklch(0.3 0.02 300);
  --sidebar-ring: oklch(0.5 0.02 300);
}

/* =============================
   Tailwind "@theme inline" tokens
   ============================= */
@theme inline {
  --font-sans: var(--font-geist-sans);
  --font-mono: var(--font-geist-mono);
  --font-size-base: 1rem;
  --font-size-lg: 1.125rem;
  --font-size-xl: 1.25rem;

  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --color-card: var(--card);
  --color-card-foreground: var(--card-foreground);
  --color-popover: var(--popover);
  --color-popover-foreground: var(--popover-foreground);
  --color-primary: var(--primary);
  --color-primary-foreground: var(--primary-foreground);
  --color-secondary: var(--secondary);
  --color-secondary-foreground: var(--secondary-foreground);
  --color-muted: var(--muted);
  --color-muted-foreground: var(--muted-foreground);
  --color-accent: var(--accent);
  --color-accent-foreground: var(--accent-foreground);
  --color-destructive: var(--destructive);
  --color-destructive-foreground: var(--destructive-foreground);
  --color-border: var(--border);
  --color-input: var(--input);
  --color-ring: var(--ring);
  --color-chart-1: var(--chart-1);
  --color-chart-2: var(--chart-2);
  --color-chart-3: var(--chart-3);
  --color-chart-4: var(--chart-4);
  --color-chart-5: var(--chart-5);

  --radius-sm: calc(var(--radius) - 4px);
  --radius-md: calc(var(--radius) - 2px);
  --radius-lg: var(--radius);
  --radius-xl: calc(var(--radius) + 4px);

  --color-sidebar: var(--sidebar);
  --color-sidebar-foreground: var(--sidebar-foreground);
  --color-sidebar-primary: var(--sidebar-primary);
  --color-sidebar-primary-foreground: var(--sidebar-primary-foreground);
  --color-sidebar-accent: var(--sidebar-accent);
  --color-sidebar-accent-foreground: var(--sidebar-accent-foreground);
  --color-sidebar-border: var(--sidebar-border);
  --color-sidebar-ring: var(--sidebar-ring);
}

/* ============ Base Layer ============ */
@layer base {
  * {
    @apply border-border outline-ring/50;
  }

  /* Soft ashy / bluish glass gradient */
  body,
  .bg-app {
    @apply bg-gradient-to-br from-primary/5 via-secondary/5 to-accent/5 text-foreground;
    @apply min-h-screen;
    font-size: 1rem;
    line-height: 1.6;
    background-attachment: fixed;
    background-repeat: no-repeat;
  }

  /* iOS safe areas */
  .app-safe-area {
    padding-left: max(1rem, env(safe-area-inset-left));
    padding-right: max(1rem, env(safe-area-inset-right));
    padding-bottom: max(1.5rem, env(safe-area-inset-bottom));
  }
}

/* ============ App UI Helpers ============ */
.estimator-container {
  @apply min-h-screen;
}

/* Cards */
.calculator-card {
  @apply bg-white/40 backdrop-blur-xl border border-white/30 shadow-2xl;
  @apply relative overflow-hidden rounded-xl;
}
.calculator-card::before {
  content: "";
  @apply absolute inset-0 bg-gradient-to-br from-white/20 to-transparent pointer-events-none;
}

/* Inputs / Selects */
.calculator-input {
  @apply bg-white/60 backdrop-blur-md border-white/40 text-foreground placeholder:text-muted-foreground;
  @apply focus:border-primary focus:ring-2 focus:ring-primary/30 focus:bg-white/80;
  @apply transition-all duration-200 shadow-sm rounded-lg;
  font-size: 1rem;
  text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8);
}
.calculator-select {
  @apply bg-white/60 backdrop-blur-md border-white/40 text-foreground;
  @apply focus:border-primary focus:ring-2 focus:ring-primary/30 focus:bg-white/80;
  @apply transition-all duration-200 shadow-sm rounded-lg;
  font-size: 1rem;
  text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8);
}

/* Buttons */
.calculator-button-primary {
  @apply bg-primary text-primary-foreground hover:bg-primary/90 shadow-lg hover:shadow-xl transition-all duration-200;
}
.calculator-button-secondary {
  @apply bg-white/50 backdrop-blur-md text-foreground border border-white/40 hover:bg-white/70 transition-all duration-200 shadow-md;
}

/* Step indicators */
.step-indicator {
  @apply flex items-center justify-center w-12 h-12 rounded-full text-base font-semibold transition-all duration-200;
}
.step-indicator.active {
  @apply bg-primary text-primary-foreground shadow-lg;
}
.step-indicator.completed {
  @apply bg-accent text-accent-foreground shadow-md;
}
.step-indicator.inactive {
  @apply bg-white/30 backdrop-blur-md text-muted-foreground border-2 border-white/40;
}

/* Elegant glass card */
.elegant-card {
  @apply bg-white/50 backdrop-blur-xl border border-white/40 rounded-xl shadow-lg relative overflow-hidden;
}
.elegant-card::before {
  content: "";
  @apply absolute inset-0 bg-gradient-to-br from-white/30 to-transparent pointer-events-none;
}

/* Enhanced buttons */
.btn-enhanced-primary {
  @apply relative bg-primary text-primary-foreground shadow-xl hover:shadow-2xl hover:scale-[1.02] hover:bg-primary/90 active:scale-[0.98] transition-all duration-200 focus-visible:outline-none focus-visible:ring-4 focus-visible:ring-primary/40 backdrop-blur-sm rounded-lg;
  font-size: 1rem;
  font-weight: 600;
}
.btn-enhanced-primary::before {
  content: "";
  @apply absolute inset-0 rounded-lg bg-gradient-to-br from-white/20 to-transparent pointer-events-none;
}

.btn-enhanced-secondary {
  @apply relative bg-secondary text-secondary-foreground shadow-lg hover:shadow-xl hover:scale-[1.01] hover:bg-secondary/90 active:scale-[0.98] transition-all duration-200 focus-visible:outline-none focus-visible:ring-4 focus-visible:ring-secondary/40 backdrop-blur-sm rounded-lg;
  font-size: 1rem;
  font-weight: 600;
}
.btn-enhanced-secondary::before {
  content: "";
  @apply absolute inset-0 rounded-lg bg-gradient-to-br from-white/20 to-transparent pointer-events-none;
}

.btn-enhanced-accent {
  @apply relative bg-accent text-accent-foreground shadow-lg hover:shadow-xl hover:scale-[1.01] hover:bg-accent/90 active:scale-[0.98] transition-all duration-200 focus-visible:outline-none focus-visible:ring-4 focus-visible:ring-accent/40 backdrop-blur-sm rounded-lg;
  font-size: 1rem;
  font-weight: 600;
}
.btn-enhanced-accent::before {
  content: "";
  @apply absolute inset-0 rounded-lg bg-gradient-to-br from-white/20 to-transparent pointer-events-none;
}

/* Generic glass card */
.card-glass {
  @apply bg-white/40 backdrop-blur-xl border border-white/30 shadow-xl rounded-xl relative overflow-hidden;
}
.card-glass::before {
  content: "";
  @apply absolute inset-0 bg-gradient-to-br from-white/25 to-transparent pointer-events-none;
}

/* Typography */
.heading-xl {
  @apply text-4xl md:text-5xl font-bold tracking-tight text-foreground;
  text-shadow: 0 2px 4px rgba(255, 255, 255, 0.5);
}
.heading-lg {
  @apply text-3xl md:text-4xl font-bold tracking-tight text-foreground;
  text-shadow: 0 2px 4px rgba(255, 255, 255, 0.5);
}
.heading-md {
  @apply text-2xl md:text-3xl font-semibold text-foreground;
  text-shadow: 0 1px 3px rgba(255, 255, 255, 0.5);
}
.body-muted {
  @apply text-base text-muted-foreground leading-relaxed;
}

/* Motion prefs */
@media (prefers-reduced-motion: reduce) {
  .btn-enhanced-primary,
  .btn-enhanced-secondary,
  .btn-enhanced-accent,
  .step-indicator {
    @apply transition-none;
  }
  * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

/* Pulse animation */
@keyframes pulse-glow {
  0%,
  100% {
    box-shadow: 0 4px 20px rgba(157, 96, 159, 0.4),
      0 0 40px rgba(157, 96, 159, 0.2);
  }
  50% {
    box-shadow: 0 6px 30px rgba(157, 96, 159, 0.6),
      0 0 60px rgba(157, 96, 159, 0.3);
  }
}
.pulse-cta {
  animation: pulse-glow 2s ease-in-out infinite;
}
@media (prefers-reduced-motion: reduce) {
  .pulse-cta {
    animation: none;
  }
}

/* Section header */
.section-header {
  @apply bg-primary/90 backdrop-blur-md text-primary-foreground px-8 py-6 rounded-t-xl relative overflow-hidden shadow-lg;
}
.section-header::before {
  content: "";
  @apply absolute inset-0 bg-gradient-to-br from-white/20 to-transparent pointer-events-none;
}
.section-content {
  @apply p-8 space-y-6;
}

/* Badges / form helpers */
.info-badge {
  @apply inline-flex items-center px-4 py-2 rounded-full text-sm font-semibold bg-accent/20 backdrop-blur-md text-accent border border-accent/40 shadow-md;
}
.field-group {
  @apply space-y-3;
}
.field-label {
  @apply text-base font-bold text-foreground;
  text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8);
}
.field-hint {
  @apply text-sm text-muted-foreground leading-relaxed;
}
.divider {
  @apply h-px bg-white/30 my-6;
}

/* Progress */
.glass-progress {
  @apply bg-white/30 backdrop-blur-lg border border-white/40 rounded-full shadow-lg relative overflow-hidden;
}
.glass-progress::before {
  content: "";
  @apply absolute inset-0 bg-gradient-to-r from-white/20 to-transparent pointer-events-none;
}

/* iFrames rounded */
iframe {
  border-radius: 0.75rem;
}

/* Fallback when backdrop-filter unsupported */
@supports not (
  (-webkit-backdrop-filter: blur(1px)) or (backdrop-filter: blur(1px))
) {
  .calculator-card,
  .elegant-card,
  .card-glass {
    background-color: rgba(255, 255, 255, 0.88);
  }
}

/* =========================================================
   ===== Ad image overlay badge (Sponsored pill + watermark)
   ========================================================= */
.ad-wrap {
  position: relative;
  border-radius: 14px;
  overflow: hidden; /* clip badge to image radius */
}

.ad-label {
  position: absolute;
  top: 8px;
  right: 8px;
  z-index: 50;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 4px 8px;
  border-radius: 9999px;
  font-size: 11px;
  font-weight: 700;
  letter-spacing: 0.03em;
  text-transform: uppercase;

  background: rgba(255, 255, 255, 0.9);
  -webkit-backdrop-filter: saturate(180%) blur(8px);
  backdrop-filter: saturate(180%) blur(8px);
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
  border: 1px solid rgba(0, 0, 0, 0.06);
}

.ad-label .ad-i {
  display: grid;
  place-items: center;
  width: 16px;
  height: 16px;
  border-radius: 9999px;
  background: #3b82f6; /* Tailwind blue-500 */
  color: #fff;
  font-size: 10px;
  line-height: 1;
  font-weight: 900;
}

/* Optional faint watermark */
.ad-wrap::after {
  content: "ADVERTISEMENT";
  position: absolute;
  right: 10px;
  bottom: 8px;
  z-index: 40;
  font-size: 10px;
  font-weight: 800;
  letter-spacing: 0.18em;
  color: rgba(0, 0, 0, 0.25);
  transform: rotate(-5deg);
  pointer-events: none;
}
// app/layout.tsx
import type React from "react";
import type { Metadata, Viewport } from "next";
import { GeistSans } from "geist/font/sans";
import { GeistMono } from "geist/font/mono";
import { Analytics } from "@vercel/analytics/next";
import { Suspense } from "react";
import Script from "next/script";
import Link from "next/link";
import "./globals.css";

import SessionGuard from "@/components/SessionGuard";
import RightRail from "@/components/RightRail";

export const metadata: Metadata = {
  title: "Interior Design Calculator",
  description:
    "Quick, transparent interior design cost estimatesâ€”for kitchens, bedrooms, living rooms and more.",
  icons: [{ rel: "icon", url: "/favicon.ico" }],
  manifest: "/site.webmanifest",
  other: {
    "apple-mobile-web-app-capable": "yes",
    "apple-mobile-web-app-status-bar-style": "default",
  },
};

export const viewport: Viewport = {
  width: "device-width",
  initialScale: 1,
  viewportFit: "cover",
};

export default function RootLayout({
  children,
}: Readonly<{ children: React.ReactNode }>) {
  const timeoutMin = Number(process.env.NEXT_PUBLIC_SESSION_TIMEOUT_MIN ?? 30);
  const timeoutMs = timeoutMin * 60 * 1000;

  return (
    <html lang="en" className="h-full">
      <body
        className={`h-full antialiased font-sans ${GeistSans.variable} ${GeistMono.variable} min-h-screen overflow-y-auto bg-app`}
      >
        {/* runs before any React/rehydration */}
        <Script id="icp-prehydrate-cleanup" strategy="beforeInteractive">
          {`
  (function(){
    try {
      var LA='ICP_LAST_ACTIVE';
      var NOW=Date.now();
      var t = Number(localStorage.getItem(LA) || 0);
      var TIMEOUT=${timeoutMs};
      if (!t || NOW - t > TIMEOUT) {
        localStorage.removeItem('ICP_STATE');
        localStorage.removeItem('interior-estimator-storage');
        localStorage.removeItem(LA);
      }
    } catch(e) {}
  })();
`}
        </Script>

        <SessionGuard estimatorRoot="/estimator">
          <Suspense fallback={null}>
            {/* global page heading (top of every page) */}
            <header className="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 pt-6">
              <div className="flex justify-center">
                <div className="card-glass rounded-xl px-5 py-4 w-full sm:w-auto">
                  <h1 className="heading-md text-center">
                    Estimate Your Interior Design Costs
                  </h1>
                </div>
              </div>
            </header>

            {/* main layout container */}
            <div className="app-safe-area mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-6">
              <div className="grid gap-6 lg:grid-cols-[minmax(0,1fr)_300px] xl:grid-cols-[minmax(0,1fr)_320px]">
                <main className="min-w-0">{children}</main>

                {/* Right rail hidden on small screens */}
                <aside className="hidden lg:block">
                  <div className="sticky top-4">
                    <RightRail />
                  </div>
                </aside>
              </div>
            </div>

            {/* global bottom disclaimer (faded but visible) */}
            <footer className="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 pb-8">
              <div className="card-glass rounded-xl px-6 py-5">
                <h2 className="text-base font-semibold text-foreground/80">
                  Disclaimer
                </h2>
                <p className="mt-2 text-sm leading-relaxed text-foreground/70">
                  This calculator provides an approximate estimate based on
                  general market trends and standard design assumptions. Actual
                  project costs may differ due to variations in material
                  selection, labor rates, design complexity, and other factors.
                  These figures are indicative and not a final quotation.
                </p>
                <div className="mt-3">
                  <Link
                    href="/disclaimer"
                    className="btn-enhanced-secondary px-3 py-2 rounded-lg text-sm inline-block"
                    aria-label="Read full Disclaimer & Terms"
                  >
                    Full Disclaimer &amp; Terms
                  </Link>
                </div>
              </div>
            </footer>
          </Suspense>

          <Analytics />
        </SessionGuard>
      </body>
    </html>
  );
}
